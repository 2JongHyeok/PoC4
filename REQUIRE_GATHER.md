# 🤖 AI CLI 협업 가이드: PoC4 (2D 오픈월드 마법사 게임)

이 문서는 AI가 **‘PoC4’** 프로젝트의 코드를 생성하고 수정할 때 반드시 준수해야 하는 **기술적, 아키텍처적, 스타일 규칙**을 정의합니다.

**AI 역할:** 10년 차 시니어 Unity 클라이언트 프로그래머

---

## 1. 🎯 프로젝트 개요 및 환경 설정

| 항목 | 설정 값 | 비고 |
| :--- | :--- | :--- |
| **프로젝트 이름** | `PoC4` | **2D 오픈월드 마법사 RPG 프로토타입** |
| **핵심 컨셉** | **초급 마법사가 대마법사가 되기 위해 여행하며 성장하는 오픈월드 RPG** |
| **핵심 시스템** | **1~9서클 멀티 캐스팅 시스템** (시간에 따른 마법 등급 변화) |
| **주요 언어** | **C# (최신 문법)** |
| **게임 엔진** | **Unity 6 (6000.0.61f1)** |
| **렌더 파이프라인** | URP |
| **플랫폼** | PC |

---

## 2. 📜 협업 및 코딩 스타일 규칙 (PoC 공통 규칙 유지)

> 다음 9개 규칙은 PoC3 버전과 동일하게 적용됩니다.

1. **KISS & YAGNI:** 필수 기능 중심, 단순하고 읽기 쉬운 코드로 우선 구현  
2. **SRP:** 스크립트 1개 = 역할 1개  
3. **State 패턴:** 행동/캐스팅/전투 등은 `IState` + `StateMachine` 구조  
4. **통신:** 직접 참조 금지, `event Action<>` 또는 `UnityEvent` 사용  
5. **데이터 분리:** 마법 정보, 서클별 수치 등은 **ScriptableObject**로 관리  
6. **코드 스타일:** 영어 기반, 핵심 주석 포함, 필요 시만 Get/Set 사용  
7. **로그:** 초기화, 상태 변경, 캐스팅 완료, 에러 시 명확한 로그 추가  
8. **Unity 사용 요약:** 각 스크립트 끝에 “Usage in Unity” 섹션 필수  

---

## 3. 🧙‍♂️ 게임 코어 시스템 설계

### 3.1. 월드 구조 (`WorldManager`, `PlayerController`)

| 구분 | 설명 |
| :--- | :--- |
| **맵 형태** | 2D 오픈월드, 여러 지역(숲, 마을, 던전 등)으로 구성. 단, 현재 단계는 POC라 들판 필드만 구현 100x100크기. |
| **플레이어 이동** | WASD이동 , Rigidbody2D 기반 |
| **카메라 추적** | `CinemachineCamera` + `PlayerFollow` 구조 |

---

### 3.2. 마법 시전 시스템 (`SpellCastingSystem`, `SpellBase`, `CastingUIManager`)

| 구분 | 설명 |
| :--- | :--- |
| **마법 서클 구조** | 1~9 서클로 구성, 각 서클은 ScriptableObject(`SpellData`)로 관리 |
| **시전 절차** | ① 마법 선택 → ② 마우스 클릭으로 발사 위치 지정 → ③ 캐스팅 시작 → ④ 마우스 클릭으로 발사 |
| **캐스팅 게이지 (멀티 슬라이드바)** | 각 서클마다 **슬라이드바 UI**가 순차적으로 표시됨. 슬라이드 바 옆에 Text로 몇 서클 마법 시전중인지 표시 |
| **캐스팅 시간 예시** | 1서클: 3초 → 2서클: 추가 5초 → 총 8초 |
| **게이지 표시 방식** | - 1서클 진행 중: 첫 슬라이드바 표시  
  - 3초 경과 시: 1서클 완료 → 슬라이드 바 초기화 후 재시작 (2서클용)  
  - 이후 서클도 동일하게 누적 표시 |
| **중단 조건** | - 이동 입력 발생  
  - 다른 마법 버튼 입력 |
| **발사 규칙** | 1서클 이상 마법이 충전된 후 좌클릭시 발사.  중단 시 발사 취소 |
| **실패 규칙** | 1서클 미완성 상태에서 중단 → 마법 발사 실패, 단 1서클 미완성 상태에서 좌클릭을 해도 마법이 중단되지 않음. |
| **시전 UI 관리** | `CastingUIManager`가 서클의 슬라이드바를 동적으로 생성 및 제거 |

---

### 3.3. 마법 데이터 구조 (`SpellData`, `SpellEffect`, `SpellLevelCurve`)

| 구분 | 설명 |
| :--- | :--- |
| **`SpellData`** | 각 마법의 기본 정보 (이름, 속성, 이펙트 서클별 파워 곡선) |
| **`SpellEffect`** | 마법 발사 시 적용되는 효과 (데미지, 넉백, 슬로우, 지속데미지 등) |
| **`SpellLevelCurve`** | 서클에 따른 스탯 성장 곡선 (데미지, 범위, 쿨타임등) |
| **확장성** | 각 마법은 `SpellBase` 추상 클래스를 상속받아 고유 시전 로직을 구현 |

---

### 3.4. 플레이어 성장 시스템 (`PlayerStats`, `LevelUpManager`)

| 구분 | 설명 |
| :--- | :--- |
| **기본 스탯** | 체력, 마나, 공격력, 방어력, 캐스팅 속도 |
| **레벨 업 규칙** | 경험치 획득 시 스탯 자동 증가 |
| **마법 숙련도** | 각 마법 서클을 일정 횟수 이상 성공 시, 해당 서클의 캐스팅 속도 단축 |
| **패시브 효과** | 서클 숙련도나 아이템으로 지속 효과 부여 (예: 1서클 마법 0.5초 단축) |

---

### 3.5. 전투 및 타겟팅 (`CombatManager`, `Enemy`, `ProjectileSpell`)

| 구분 | 설명 |
| :--- | :--- |
| **타겟팅 방식** | 마우스 클릭 지점 방향으로 마법 발사 마법의 효과 범위나 최종 범위 2d Sprite Circle로 보여주기. |
| **물리 처리** | Rigidbody2D + Collider2D 충돌 기반 |
| **마법체 관리** | 오브젝트 풀링(`ObjectPool<ProjectileSpell>`)로 관리 |
| **피격 판정** | Enemy는 `IDamageable` 인터페이스를 구현 |

---

## 4. ⏱️ 캐스팅 시스템 단계별 요약

| 단계 | 설명 |
| :--- | :--- |
| **Step 1. StartCasting()** | 마법 선택후 마우스 왼쪽 버튼 클릭 시 시작, 첫 슬라이드바 표시 |
| **Step 2. WaitForCircle(n)** | n서클 게이지가 차면 다음 서클로 넘어감 |
| **Step 3. Interrupt()** | 이동/피격 시 마지막 완성된 서클까지만 유지 |
| **Step 4. FireSpell()** | 완성된 서클 수에 맞는 SpellData로 발사 |
| **Step 5. ResetCasting()** | 모든 UI 및 상태 초기화 |

---

## 5. 🧩 데이터 구조 예시 (요약)

```csharp
[CreateAssetMenu(menuName = "Spells/SpellData")]
public class SpellData : ScriptableObject
{
    public string spellName;
    public Sprite icon;
    public float[] castingTimes; // e.g., [3, 5, 7, ...]
    public float[] damages;
    public GameObject projectilePrefab;
}

## 6. 📋 AI 출력 및 피드백 규칙

요청 형식:
**MODULE_NAME**: [세부 요청]
예)
**SPELL_SYSTEM**: 캐스팅 중단 시 마지막 완성된 서클까지만 발사되는 로직 작성해줘.

불명확 정보 처리:
불명확하거나 데이터 미정 시 추정 금지, 반드시 질문 또는 TODO: [명확화 필요] 주석 추가

Unity 버전 확인:
Unity 6 (6000.0.61f1) 기준.
버전 의존 로직 작성 시 반드시 명시

본 문서는 PoC4 프로젝트의 AI 협업용 기술 기준서이며, 코드 생성, 수정, 설계 시 이 규칙을 절대적으로 준수해야 한다.